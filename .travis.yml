dist: bionic
sudo: true
language: python
python:
- 3.6.8
services:
- docker
before_install:
- sudo -E apt-get -yq --no-install-suggests --no-install-recommends install postgresql-11
  postgresql-client-11
- sudo -E sed -i -e '/local.*peer/s/postgres/all/' -e 's/peer\|md5/trust/g' /etc/postgresql/*/main/pg_hba.conf
- sudo -E sed -i 's/port = 5433/port = 5432/' /etc/postgresql/*/main/postgresql.conf
- sleep 10
- sudo -E service postgresql stop 10
- sudo -E ps axuwww | grep -i postg
- if [ ! -d /var/ramfs/postgresql/11/main ]; then sudo -u postgres /usr/lib/postgresql/11/bin/initdb
  -D /var/ramfs/postgresql/11/main; fi
- sudo -E systemctl -l restart postgresql@11-main
- sudo -E systemctl -l status postgresql@11-main
before_script:
- psql -U postgres -c "CREATE USER connect WITH PASSWORD 'connect';"
- psql -U postgres -c "ALTER ROLE connect WITH SUPERUSER;"
- psql -U connect postgres -c "CREATE DATABASE connect;"
install:
- pip install pipenv
- pipenv install --system --dev
- pip install coveralls
env:
  global:
  - SECRET_KEY=SK
  - DEFAULT_DATABASE="postgres://connect:connect@localhost:5432/connect"
  - OIDC_RP_SERVER_URL=
  - OIDC_RP_REALM_NAME=
  - OIDC_RP_CLIENT_ID=
  - OIDC_RP_CLIENT_SECRET=
  - OIDC_OP_AUTHORIZATION_ENDPOINT=
  - OIDC_OP_TOKEN_ENDPOINT=
  - OIDC_OP_USER_ENDPOINT=
  - OIDC_OP_JWKS_ENDPOINT=
  - OIDC_RP_SIGN_ALGO=
  - OIDC_OP_LOGOUT_ENDPOINT=
  - BILLING_COST_PER_WHATSAPP=0.0
  - BILLING_TEST_MODE=True
  - secure: HFv4tJ4lVBnSIlIEQqJvp5tH/vJOLhA/5jdLbt/2zvKXlTG1muHTzAPr+Pl5ZpLHbhuOec7KsAILnZgYY97RwyH87SiRAzZYH3diXKBSkRNfX7An/L0U24qan5CrbsCsuOeEbuwl0LBUV1ARmAlpCGYGPqis4F+354XMbwz09890LBA+TpsYqWxA5LHWSaSHlCdR1A1HgLSk0SSY4CLwqxB7QOol5znIj4H3GvcxT+B6UGUoL0ovtxVVQUXJs1LM7+DX5Gqd7ipjMyCtgmS5ebVq1YGZy6Yk1HPIKa+LrnbbrP8d8hLJDaU5TDhAF9wKlKZ5v8g243aHGwB9HDKcIzOECoLDCoeK12bZdaxM7ipEs0y+MgOu7FBzcmiSVMhYuzTjIMA9ts6xhU0h7FOS31DJCYifmE7R0ZEW8ARr3dF+uckqSFFGpKg3QG+q3Svjhlba9CxSJxmhyWKw74gU9R8SzwwMogCAHgkUQHisWD9cNIh+cDo68+aiCjRbsQ3XNZXdUl+FX2WnGZgRaw+52kZTKBi9WDN5RuMzzdSM4WNnyzWjsAMAa+sOYv4kQd5GnAYno3w00zMc883ndENEu8SrYxbcra0rFPBnLGKeAmIwm8+w1Xmii7Pap6LToaz0ZcGNwaxxWzpqh76A6ZDPfcEiCorXLf85xgJqFXPYQ4w=
script:
- python manage.py migrate
- python manage.py collectstatic --noinput
- flake8
- travis_wait coverage run manage.py test
after_success:
- coveralls
